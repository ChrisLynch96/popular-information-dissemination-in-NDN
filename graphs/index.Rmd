---
title: "Popular information dissemination in Vehicular Ad-Hoc networks - Results Exploration"
author: "Christopher Lynch"
theme: lumen
always_allow_html: true
output:
  pdf_document:
    toc: yes
    toc_depth: '3'
    number_sections: yes
  html_document:
    number_sections: yes
    toc: yes
    toc_collapsed: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include = FALSE, error = FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, error=F, warning=F)
library(tidyverse) # collection of packages for every day data science (ggplot2, dplyr, tidyr, readr, purrr, tibble, stringr, forcats)
library(RColorBrewer) # package for choosing sensible colours for plots
library(plotly) # package for making production ready plots (should use this for plotting me thinks)
library(lubridate) # package for data and time
library(caret) # machinelearning
library(tidytext) # Package for conversion of text to
library(spacyr)
# Chord diagram
library(circlize)
#theme
my_theme <- function(base_size = 12, base_family = "Helvetica"){
    theme(axis.title.y = element_blank(),axis.title.x = element_blank(),
    plot.title = element_text(face="bold", size=16),
    axis.text = element_text(face="bold"),
    plot.background = element_rect(fill = 'snow2',color='white'),
    strip.text.y = element_text(angle=180),
    legend.position = 'None', legend.title = element_blank())
}
```

``` {r functions, echo=FALSE}
setwd("~/workspace/github.com/ChrisLynch96/masters-project/scenario-template/graphs")

disseminationMethods <- c("pure-ndn", "unsolicited", "proactive")

plot_packet_nodes_totals <- function(disseminationMethod, dir) {
  data.packets <- read.table(str_c("./data/", disseminationMethod, "/", dir, "/rate-trace.txt"), header=T)
  data.packets$Node = factor(data.packets$Node)
  data.packets = data.packets[c("Time", "Node", "PacketRaw")]
  
  ## Packet totals for each node
  data.packets.nodes = aggregate(PacketRaw ~ Time + Node, data=data.packets, FUN=sum)
  g.packets.nodes <- ggplot(data.packets.nodes) +
    geom_line(aes (x=Time, y=PacketRaw), size=1) +
    ylab("Number of packets") + facet_wrap(~ Node)
  
  fig <- ggplotly(g.packets.nodes)
}

plot_packet_all_total <- function(disseminationMethod, dir) {
  data.packets <- read.table(str_c("./data/", disseminationMethod, "/", dir, "/rate-trace.txt"), header=T)
  data.packets$Node = factor(data.packets$Node)
  data.packets = data.packets[c("Time", "Node", "PacketRaw")]
  
  data.packets.nodes = aggregate(PacketRaw ~ Time + Node, data=data.packets, FUN=sum)
  
  data.packets.total = aggregate(PacketRaw ~ Time, data=data.packets.nodes, FUN=sum)
  
  g.packets.total <- ggplot(data = data.packets.total, aes (x=Time, y=PacketRaw), size=1) +
    geom_line() +
    geom_point() +
    ggtitle(dir) +
    ylab("Packet Numbers")
  
  fig <- ggplotly(g.packets.total)
}

plot_packet_all_total2 <- function(dir) {
  data.combined <- combine_methods_packet(dir)
  
  data.combined$Node = factor(data.combined$Node)
  data.combined = data.combined[c("Time", "Node", "PacketRaw", "method")]
  
  data.combined.nodes = aggregate(PacketRaw ~ Time + Node + method, data=data.combined, FUN=sum)
  
  data.combined.total = aggregate(PacketRaw ~ Time + method, data=data.combined.nodes, FUN=sum)
  
  g.packets.total <- ggplot(data = data.combined.total, aes (x=Time, y=PacketRaw, group=method, colour=method, shape=method), size=1) +
    geom_line() +
    geom_point() +
    ggtitle(dir) +
    ylab("Packet Numbers")
  
  fig <- ggplotly(g.packets.total)
}

plot_delay_all_total <- function(disseminationMethod, dir) {
  data.delay = read.table(str_c("./data/", disseminationMethod, "/", dir, "/app-delays-trace.txt"), header=T) 
  
  ## Data processing
  data.delay.filtered <- data.delay[c("Time", "Type", "DelayS")]

  g.last.delay <- ggplot(data.delay.filtered) +
    geom_line(aes (x=Time, y=DelayS), size=1) +
    ggtitle(dir) +
    ylab("Delay (seconds)")
  
  fig <- ggplotly(g.last.delay)
}

plot_delay_all_total2 <- function(dir) {
  data.delay <- combine_methods_packet(dir, TRUE)
  
  ## Data processing
  data.delay.filtered <- data.delay[c("Time", "Type", "DelayS", "method")]

  g.last.delay <- ggplot(data.delay.filtered, aes (x=Time, y=DelayS, group=method, colour=method, shape=method), size=1) +
    geom_line() +
    geom_point() +
    ggtitle(dir) +
    ylab("Delay (seconds)")
  
  fig <- ggplotly(g.last.delay)
}

combine_methods_packet <- function(dir, delay = FALSE) {
  
  if (delay) {
    data.ndn <- read.table(str_c("./data/", disseminationMethods[1], "/", dir, "/app-delays-trace.txt"), header=T)
    data.ndn['method'] = 'pure-ndn'
    data.unsolicited <- read.table(str_c("./data/", disseminationMethods[2], "/", dir, "/app-delays-trace.txt"), header=T)
    data.unsolicited['method'] = 'unsolicited'
    data.proactive <- read.table(str_c("./data/", disseminationMethods[3], "/", dir, "/app-delays-trace.txt"), header=T)
    data.proactive['method'] = 'proactive'
    
    data.combined <- rbind(data.ndn, data.unsolicited)
    data.combined <- rbind(data.combined, data.proactive)
    as.factor(data.combined$method)
    
    return(data.combined)
  } else {
    data.ndn <- read.table(str_c("./data/", disseminationMethods[1], "/", dir, "/rate-trace.txt"), header=T)
    data.ndn['method'] = 'pure-ndn'
    data.unsolicited <- read.table(str_c("./data/", disseminationMethods[2], "/", dir, "/rate-trace.txt"), header=T)
    data.unsolicited['method'] = 'unsolicited'
    data.proactive <- read.table(str_c("./data/", disseminationMethods[3], "/", dir, "/rate-trace.txt"), header=T)
    data.proactive['method'] = 'proactive'
    
    data.combined <- rbind(data.ndn, data.unsolicited)
    data.combined <- rbind(data.combined, data.proactive)
    as.factor(data.combined$method)
    
    return(data.combined)
  }
}

get_directories <- function(disseminationMethod) {
  list.dirs(path = str_c("./data/", disseminationMethod), full.names = FALSE, recursive = FALSE)
}
```

Methods of data dissemination:

- Pure-NDN
- Unsolicited Data
- Proactive producer

Levers:

- Percentage Cars Per Hour PCPH
- Speed
- Transmission range

Metrics Measured:

- Number of packets in the network
- Latency (Last Delay)
- Number of data packets received (goodput)

# Individual methods plots

## Pure-NDN

### Packets in the networks

``` {r echo=FALSE, message=FALSE, warning=FALSE}
disseminationMethod <- disseminationMethods[1]

directories <- get_directories(disseminationMethod)

#l <- htmltools::tagList()
for (i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_packet_all_total(disseminationMethod, dir)
  fig <- plot_packet_all_total(disseminationMethod, dir)
  print(fig)
}
#l
```

### Latency (Last Delay)

``` {r echo=FALSE, message=FALSE, warning=FALSE}
#l <- htmltools::tagList()
for(i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_delay_all_total(disseminationMethod, dir)
  fig <- plot_delay_all_total(disseminationMethod, dir)
  
  print(fig)
}
#l
```

### No. Data packets received

## Unsolicited

### Packets in the networks

``` {r echo=FALSE, message=FALSE, warning=FALSE}
disseminationMethod <- disseminationMethods[2]
directories <- get_directories(disseminationMethod)

#l <- htmltools::tagList()
for (i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_packet_all_total(disseminationMethod, dir)
 fig <- plot_packet_all_total(disseminationMethod, dir)
 print(fig)
}
#l
```

### Latency (Last Delay)

``` {r echo=FALSE, message=FALSE, warning=FALSE}
#l <- htmltools::tagList()
for(i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_delay_all_total(disseminationMethod, dir)
  fig <- plot_delay_all_total(disseminationMethod, dir)
  print(fig)
}
#l
```

## Proactive

### Packets in the networks

``` {r echo=FALSE, message=FALSE, warning=FALSE}
disseminationMethod <- disseminationMethods[3]

directories <- get_directories(disseminationMethod)

#plot_packet_totals(disseminationMethod = disseminationMethod, dir = directories[1])

#l <- htmltools::tagList()
for (i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_packet_all_total(disseminationMethod, dir)
  fig <- plot_packet_all_total(disseminationMethod, dir)
  print(fig)
}
#l
```

### Latency (Last Delay)

``` {r echo=FALSE, message=FALSE, warning=FALSE}
#l <- htmltools::tagList()
for(i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_delay_all_total(disseminationMethod, dir)
  fig <- plot_delay_all_total(disseminationMethod, dir)
  print(fig)
}
#l
```

# Packet Numbers comparison

``` {r echo=FALSE, message=FALSE, warning=FALSE}

directories <- get_directories(disseminationMethod)

#l <- htmltools::tagList()
for (i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_packet_all_total2(dir)
  fig <- plot_packet_all_total2(dir)
  print(fig)
}
#l
```

# Last Delay comparison

``` {r echo=FALSE, message=FALSE, warning=FALSE}
#l <- htmltools::tagList()
for(i in 1:length(directories)) {
  dir <- directories[i]
  #l[[i]] <- plot_delay_all_total2(dir)
  fig <- plot_delay_all_total2(dir)
  print(fig)
}
#l
```






